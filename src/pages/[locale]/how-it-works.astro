---
// [locale]/how-it-works.astro - Localized how-it-works page
import PageLayout from '../../layouts/PageLayout.astro';
import PricingCard from '../../components/PricingCard.astro';
import FaqAccordion from '../../components/FaqAccordion.astro';
import CtaSection from '../../components/CtaSection.astro';
import servicesData from '../../data/services.json';
import { getNonDefaultLocales, t, localizedUrl } from '../../i18n/utils';
import type { Locale } from '../../i18n/config';

export function getStaticPaths() {
  return getNonDefaultLocales().map(locale => ({
    params: { locale },
    props: { locale },
  }));
}

const { locale } = Astro.props as { locale: Locale };

const steps = [
  { number: '01', icon: 'ðŸ“–', titleKey: 'howItWorks.step0.title', descKey: 'howItWorks.step0.desc' },
  { number: '02', icon: 'ðŸ“…', titleKey: 'howItWorks.step1.title', descKey: 'howItWorks.step1.desc' },
  { number: '03', icon: 'ðŸ’¬', titleKey: 'howItWorks.step2.title', descKey: 'howItWorks.step2.desc' },
  { number: '04', icon: 'âœ…', titleKey: 'howItWorks.step3.title', descKey: 'howItWorks.step3.desc' },
];

// Build translated pricing data
const pricingPlans = servicesData.pricing.map(plan => ({
  name: t(locale, `pricing.${plan.id}.name`),
  price: plan.price,
  currency: plan.currency,
  duration: t(locale, `pricing.${plan.id}.duration`),
  description: t(locale, `pricing.${plan.id}.desc`),
  features: plan.features.map((_, i) => t(locale, `pricing.${plan.id}.feature${i}`)),
  cta: t(locale, `pricing.${plan.id}.cta`),
  highlighted: plan.highlighted,
}));
---

<PageLayout
  title={t(locale, 'howItWorks.title')}
  description={t(locale, 'howItWorks.subtitle')}
  locale={locale}
>

  <!-- Hero -->
  <section class="section-spacing bg-background relative">
    <div class="absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-border to-transparent"></div>
    <div class="container-page text-center max-w-3xl mx-auto">
      <div class="divider-gold mx-auto mb-6"></div>
      <h1 class="font-heading text-3xl md:text-4xl lg:text-5xl font-bold text-navy mb-4">
        {t(locale, 'howItWorks.title')}
      </h1>
      <p class="text-lg text-text-muted leading-relaxed">
        {t(locale, 'howItWorks.subtitle')}
      </p>
    </div>
  </section>

  <!-- Steps timeline -->
  <section id="steps" class="section-spacing bg-surface relative">
    <div class="absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-border to-transparent"></div>
    <div class="container-page max-w-3xl mx-auto">
      <div class="flex flex-col gap-0">
        {steps.map((step, i) => (
          <div class="flex gap-6 relative">
            <div class="flex flex-col items-center shrink-0">
              <div class="w-12 h-12 rounded-full bg-gradient-to-br from-navy to-navy-mid text-white flex items-center justify-center font-mono font-bold text-sm z-10 shadow-[0_4px_15px_rgba(15,35,55,0.2)]">
                {step.number}
              </div>
              {i < steps.length - 1 && (
                <div class="w-0.5 h-full bg-gradient-to-b from-border to-border-light min-h-[60px]"></div>
              )}
            </div>
            <div class="pb-10">
              <div class="flex items-center gap-2 mb-1">
                <span class="text-xl" aria-hidden="true">{step.icon}</span>
                <h3 class="font-heading text-lg font-bold text-navy">{t(locale, step.titleKey)}</h3>
              </div>
              <p class="text-text-muted text-sm leading-relaxed">{t(locale, step.descKey)}</p>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Pricing -->
  <section id="pricing" class="section-spacing bg-background relative">
    <div class="absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-border to-transparent"></div>
    <div class="container-page">
      <div class="text-center max-w-2xl mx-auto mb-12">
        <div class="divider-gold mx-auto mb-6"></div>
        <h2 class="font-heading text-3xl md:text-4xl font-bold text-navy mb-4">
          {t(locale, 'howItWorks.pricingTitle')}
        </h2>
        <p class="text-text-muted text-lg">
          {t(locale, 'howItWorks.pricingSubtitle')}
        </p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-3xl mx-auto">
        {pricingPlans.map(plan => (
          <PricingCard
            name={plan.name}
            price={plan.price}
            currency={plan.currency}
            duration={plan.duration}
            description={plan.description}
            features={plan.features}
            cta={plan.cta}
            highlighted={plan.highlighted}
            locale={locale}
          />
        ))}
      </div>
    </div>
  </section>

  <!-- FAQ -->
  <section id="faq" class="section-spacing bg-surface relative">
    <div class="absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-border to-transparent"></div>
    <div class="container-page max-w-3xl mx-auto">
      <div class="text-center mb-10">
        <div class="divider-gold mx-auto mb-6"></div>
        <h2 class="font-heading text-3xl md:text-4xl font-bold text-navy mb-4">
          {t(locale, 'howItWorks.faqTitle')}
        </h2>
        <p class="text-text-muted text-lg">
          {t(locale, 'howItWorks.faqSubtitle')}
        </p>
      </div>

      <FaqAccordion locale={locale} />
    </div>
  </section>

  <!-- Final CTA -->
  <CtaSection
    headline={t(locale, 'howItWorks.ctaHeadline')}
    subtext={t(locale, 'howItWorks.ctaSubtext')}
    locale={locale}
  />

</PageLayout>
